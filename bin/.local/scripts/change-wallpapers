#!/bin/bash

# Wallpaper directory
wallpapers_dir="${HOME}/Pictures/Wallpapers"

# store current directory
curr_dir=$(pwd)

cd ${wallpapers_dir}
opts=$(ls -d */)

# get to the directory you started with
cd ${curr_dir}

# validate param
fl=0
for i in $opts
do
    IFS="/" read -ra i <<< $i
    if [ "$1" = "$i" ]; then
        fl=1
    fi
done

if [ $fl -eq 0 ]; then
    echo "$1 not found"
    echo "Available params:"
    echo $opts
    exit 1
fi

# getting all the wallpapers
opts=$(ls "${wallpapers_dir}/$1")
wallpapers=()
for i in $opts
do
    wallpapers+=($i)
done

# path to file
ptf="$wallpapers_dir/$1"

function change_wallpaper() {
    local len=${#wallpapers[@]}

    while true
    do
        # randomly choose a wallpaper
        idx=$((RANDOM % len))

        # actually setting the wallpaper
        eval gsettings set org.gnome.desktop.background picture-uri-dark "$ptf/${wallpapers[idx]}"
        sleep 5m
    done
}

# not running it in background for now
change_wallpaper
