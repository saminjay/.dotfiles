#!/bin/bash

# Wallpaper directory
wallpapers_dir="${HOME}/Pictures/Wallpapers"

function validate_input() {
    cd ${wallpapers_dir}
    local opts=$(ls -1 -d */)

    local fl=0
    for i in $opts
    do
        IFS="/" read -ra i <<< $i
        if [ "$1" = "$i" ]; then
            fl=1
        fi
    done

    if [ $fl -eq 0 ]; then
        echo "$1 not found"
        echo "Available params:"
        echo $opts
        exit 1
    fi
}

function change_wallpaper() {
    # getting all the wallpapers
    local opts=$(ls "$2/$1")
    local wallpapers=()
    for i in $opts
    do
        wallpapers+=($i)
    done

    # path to file
    local ptf="$wallpapers_dir/$1"

    local len=${#wallpapers[@]}

    while true
    do
        # randomly choose a wallpaper
        local idx=$((RANDOM % len))

        # actually setting the wallpaper
        eval gsettings set org.gnome.desktop.background picture-uri-dark "$ptf/${wallpapers[idx]}"
        sleep 5m
    done
}

validate_input $1
change_wallpaper $1 $wallpapers_dir & disown
